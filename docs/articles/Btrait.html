<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Btrait">
<title>R-package Btrait: working with biological data and trait information • Btrait</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R-package Btrait: working with biological data and trait information">
<meta property="og:description" content="Btrait">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Btrait</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/Btrait.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BtraitData.html">Benthic density and trait databases in R-package Btrait</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>R-package Btrait: working with biological data and trait information</h1>
                        <h4 data-toc-skip class="author">Karline
Soetaert and Olivier Beauchard</h4>
            
            <h4 data-toc-skip class="date">18 November 2022</h4>
      
      
      <div class="d-none name"><code>Btrait.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="package-btrait">Package Btrait<a class="anchor" aria-label="anchor" href="#package-btrait"></a>
</h2>
<p>The R-package <em>Btrait</em> contains functions and data sets to
work with density data, trait information and taxonomic
relationships.</p>
<p>The package contains:</p>
<ul>
<li>functions to work with a combination of species-density (or
species-biomass) data, species-trait information, and taxonomy</li>
<li>two data sets with density and biomass data of the macrobenthos in
the North Sea.</li>
<li>several macrobenthos trait databases</li>
</ul>
<p>Here we explain how to work with the package functions using a small
data set.</p>
<p>Another vignette deals with the density and trait databases in the
package (<em>vignette (“BtraitData”)</em>). (to trigger this vignette in
R, write: <em>vignette (“BtraitData”)</em>).</p>
</div>
<div class="section level2">
<h2 id="density-data">Density data<a class="anchor" aria-label="anchor" href="#density-data"></a>
</h2>
<p>Taxon density data record -for a certain taxon- how many individuals
are present on a unit surface at a certain place (station). Rather than
abundances, also biomasses, i.e. the summed weight of the individuals of
that taxon, may be recorded. Typically, but not always, the densities in
a certain station will have been estimated several times (i.e. there are
replicate measurements).</p>
<p>There are two ways to represent density datasets: in format and in
format.</p>
<ul>
<li>The <em>long</em> format is most often used to store density data;
it has several columns (station, taxon, value, …). This format is
special in the sense that absences (0 densities) are NOT represented
explicitly in the data. Thus, it is implicitly assumed that, when a
taxon is not represented in the data, its density = 0. These implicit
absences need to be taken into account when performing calculations with
these data.</li>
<li>In the <em>wide</em> format, each row represents the station (where
the data were taken), while the columns represent the taxa (what), and
the values are the densities or biomasses. In this format, the absences
ARE represented, which make the format suitable for performing
calculations. However, each time a new taxon is found in a station, the
data of the other stations will also need to be changed (i.e. an extra
column with 0 densities added).</li>
</ul>
<div class="section level3">
<h3 id="a-small-density-dataset">A small density dataset<a class="anchor" aria-label="anchor" href="#a-small-density-dataset"></a>
</h3>
<p>We start with a small density dataset, a <em>data.frame</em> with
station, species, and density data, in long format.</p>
<p>In this data set, <em>st.a</em> has been sampled in 2000 and 2001
(i.e. 2 replicates), while <em>st.b</em> was sampled in 2002 only,
<em>st.c</em> only in 2003.</p>
<p>Note also that there are two records on species “sp.1” for station
“st.a” in 2001. This is not uncommon in density data: perhaps another
species was later reassigned to be “sp.1”, or separate measurements
(i.e. weighing) were done on two batches of individuals of this
species.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  station <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"st.a"</span>,<span class="st">"st.a"</span>,<span class="st">"st.a"</span>,<span class="st">"st.a"</span>,<span class="st">"st.a"</span>,<span class="st">"st.b"</span>,<span class="st">"st.b"</span>,<span class="st">"st.b"</span>,<span class="st">"st.c"</span><span class="op">)</span>,</span>
<span>  year    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>  , <span class="fl">2000</span> , <span class="fl">2001</span> , <span class="fl">2001</span> , <span class="fl">2001</span>,  <span class="fl">2002</span> , <span class="fl">2002</span> , <span class="fl">2002</span> , <span class="fl">2003</span> <span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp.1"</span>,<span class="st">"sp.2"</span>,<span class="st">"sp.1"</span>,<span class="st">"sp.1"</span>,<span class="st">"sp.4"</span>,<span class="st">"sp.2"</span>,<span class="st">"sp.3"</span>,<span class="st">"sp.4"</span>,<span class="st">"sp.4"</span><span class="op">)</span>,</span>
<span>  density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>    <span class="fl">1</span>,     <span class="fl">2</span>,     <span class="fl">3</span>,     <span class="fl">1</span>,     <span class="fl">2</span>,     <span class="fl">5</span>,     <span class="fl">3</span>,     <span class="fl">1</span>,     <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with species density information</caption>
<thead><tr class="header">
<th align="center">station</th>
<th align="center">year</th>
<th align="center">species</th>
<th align="center">density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">sp.1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">sp.2</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.1</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.4</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.2</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.3</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.4</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">st.c</td>
<td align="center">2003</td>
<td align="center">sp.4</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<p>There are 4 different species in this data set from 3 different
stations. Note that not all species are present in all stations. For a
certain station, absence of a species in the dataset means their density
= 0.</p>
<p>A complete representation of the data would be:</p>
<table class="table">
<caption>Species density with added absences</caption>
<thead><tr class="header">
<th align="center">station</th>
<th align="center">year</th>
<th align="center">species</th>
<th align="center">density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">sp.1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.1</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">sp.2</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.2</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">sp.3</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.3</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">sp.4</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">sp.4</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.2</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.3</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">sp.4</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">st.c</td>
<td align="center">2003</td>
<td align="center">sp.1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">st.c</td>
<td align="center">2003</td>
<td align="center">sp.2</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">st.c</td>
<td align="center">2003</td>
<td align="center">sp.3</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">st.c</td>
<td align="center">2003</td>
<td align="center">sp.4</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<p>The same data, in <em>wide</em> format is:</p>
<table class="table">
<caption>Species density in wide format</caption>
<thead><tr class="header">
<th align="center">station</th>
<th align="center">year</th>
<th align="center">sp.1</th>
<th align="center">sp.2</th>
<th align="center">sp.3</th>
<th align="center">sp.4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2000</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">st.a</td>
<td align="center">2001</td>
<td align="center">4</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">st.b</td>
<td align="center">2002</td>
<td align="center">0</td>
<td align="center">5</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">st.c</td>
<td align="center">2003</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<p>and, averaged over years:</p>
<table class="table">
<caption>Species density in wide format, averaged over years</caption>
<thead><tr class="header">
<th align="center">descriptor</th>
<th align="center">sp.1</th>
<th align="center">sp.2</th>
<th align="center">sp.3</th>
<th align="center">sp.4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">2.5</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">st.b</td>
<td align="center">0.0</td>
<td align="center">5</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">st.c</td>
<td align="center">0.0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="taxonomic-data">Taxonomic data<a class="anchor" aria-label="anchor" href="#taxonomic-data"></a>
</h2>
<p>The taxonomy records the relationships between the taxa.</p>
<p>Typically we order taxa in species, genus, family, order, class, and
phylum level. For real marine data, this information can be extracted
from the world register of marine species, conveniently abbreviated into
WoRMS.</p>
<p>In the WoRMS database, each taxon is also assigned a unique
identifier (AphiaID). The R-package <em>worms</em> allows to access this
database from R.</p>
<p>In <em>Btrait</em>, the taxonomy can be used in several ways:</p>
<ul>
<li>to fill in the gaps of the trait information, assuming that closely
related taxa will share similar traits, and</li>
<li>to estimate densities or trait composition on higher taxonomic
levels.</li>
</ul>
<p>In the dataset below, the species belong to 4 genera (“g.1”, “g.2”,
“g.3”, “g.4”), 3 families (“f.1”, “f.2”, “f.3”), 2 orders (“o.1”, “o.2”)
and 1 class (“c.1”).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.taxonomy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp.1"</span>,<span class="st">"sp.2"</span>,<span class="st">"sp.3"</span>,<span class="st">"sp.4"</span>,<span class="st">"sp.5"</span>,<span class="st">"sp.6"</span><span class="op">)</span>,</span>
<span>  genus   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"g.1"</span>, <span class="st">"g.2"</span>, <span class="st">"g.3"</span>, <span class="st">"g.3"</span>, <span class="st">"g.3"</span>, <span class="st">"g.4"</span><span class="op">)</span>,</span>
<span>  family  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"f.1"</span>, <span class="st">"f.1"</span>, <span class="st">"f.2"</span>, <span class="st">"f.2"</span>, <span class="st">"f.2"</span>, <span class="st">"f.3"</span><span class="op">)</span>,</span>
<span>  order   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"o.1"</span>, <span class="st">"o.1"</span>, <span class="st">"o.2"</span>, <span class="st">"o.2"</span>, <span class="st">"o.2"</span>, <span class="st">"o.2"</span><span class="op">)</span>,</span>
<span>  class   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"c.1"</span>, <span class="st">"c.1"</span>, <span class="st">"c.1"</span>, <span class="st">"c.1"</span>, <span class="st">"c.1"</span>, <span class="st">"c.1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with taxonomic information</caption>
<thead><tr class="header">
<th align="left">species</th>
<th align="left">genus</th>
<th align="left">family</th>
<th align="left">order</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sp.1</td>
<td align="left">g.1</td>
<td align="left">f.1</td>
<td align="left">o.1</td>
<td align="left">c.1</td>
</tr>
<tr class="even">
<td align="left">sp.2</td>
<td align="left">g.2</td>
<td align="left">f.1</td>
<td align="left">o.1</td>
<td align="left">c.1</td>
</tr>
<tr class="odd">
<td align="left">sp.3</td>
<td align="left">g.3</td>
<td align="left">f.2</td>
<td align="left">o.2</td>
<td align="left">c.1</td>
</tr>
<tr class="even">
<td align="left">sp.4</td>
<td align="left">g.3</td>
<td align="left">f.2</td>
<td align="left">o.2</td>
<td align="left">c.1</td>
</tr>
<tr class="odd">
<td align="left">sp.5</td>
<td align="left">g.3</td>
<td align="left">f.2</td>
<td align="left">o.2</td>
<td align="left">c.1</td>
</tr>
<tr class="even">
<td align="left">sp.6</td>
<td align="left">g.4</td>
<td align="left">f.3</td>
<td align="left">o.2</td>
<td align="left">c.1</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="trait-data-taxa-x-trait">Trait data (taxa x trait)<a class="anchor" aria-label="anchor" href="#trait-data-taxa-x-trait"></a>
</h2>
<p>Traits assign certain properties to taxa, generally relating to how
these taxa affect the ecosystem (these are called “functional effects
traits”), or how the taxa deal with their environment and will react to
changes in the environment, such as a disturbance (called “response
traits”).</p>
<p>There are two ways in which to assign traits to species:</p>
<ul>
<li>When in <em>crisp</em> format, each trait is assigned one value per
species.</li>
<li>When traits are in <em>fuzzy</em> format, a species can belong to
several modalities within one trait; for each trait the sum of the
modality proportions is <span class="math inline">\(1\)</span>.</li>
</ul>
<p>It is possible to convert traits from fuzzy to crisp format, but the
reverse conversion is not unambiguous.</p>
<p>Note that it is customary to store trait data in <em>wide</em>
format, where the taxa are the rows, and the trait modalities are the
columns.</p>
<div class="section level3">
<h3 id="a-fuzzy-coded-trait-dataset">A fuzzy-coded trait dataset<a class="anchor" aria-label="anchor" href="#a-fuzzy-coded-trait-dataset"></a>
</h3>
<p>In the trait dataset (<em>S.traits</em>) inputted below, the species
are represented by two traits (<em>T1</em>, <em>T2</em>); these traits
have 3 (<em>T1_M1</em>, <em>T1_M2</em>, <em>T1_M3</em>) and 2 modalities
(<em>T2_M1</em>, <em>T2_M2</em>) respectively. For instance, trait 1
could be the depth of occurrence of the species, and its modalities
“0-5cm”, “5-10cm”, and “10-15cm”; trait 2 could be the feeding type of
the species, either “filterfeeding” or “depositfeeding”.</p>
<p>The trait information is stored in a <em>data.frame</em> with the
names of the species in the first column, and the membership to each
trait modality in the other columns.</p>
<p>Note: information on <em>sp.4</em> is lacking in the trait database;
<em>sp.5</em> and <em>sp.6</em> from the trait database are not in the
density dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp.1"</span>,<span class="st">"sp.2"</span>,<span class="st">"sp.3"</span>,<span class="st">"sp.5"</span>,<span class="st">"sp.6"</span><span class="op">)</span>,</span>
<span>  T1_M1   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>     , <span class="fl">0</span>    ,   <span class="fl">0</span>  , <span class="fl">0.2</span>  ,     <span class="fl">1</span><span class="op">)</span>,</span>
<span>  T1_M2   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>     , <span class="fl">0</span>    , <span class="fl">0.5</span>  , <span class="fl">0.3</span>  ,     <span class="fl">0</span><span class="op">)</span>,</span>
<span>  T1_M3   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>     , <span class="fl">1</span>    , <span class="fl">0.5</span>  , <span class="fl">0.5</span>  ,     <span class="fl">0</span><span class="op">)</span>,</span>
<span>  T2_M1   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>     , <span class="fl">0</span>    ,   <span class="fl">1</span>  , <span class="fl">0.5</span>  ,     <span class="fl">1</span><span class="op">)</span>,</span>
<span>  T2_M2   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>     , <span class="fl">1</span>    ,   <span class="fl">0</span>  , <span class="fl">0.5</span>  ,     <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with species trait information, fuzzy
coded</caption>
<thead><tr class="header">
<th align="center">species</th>
<th align="center">T1_M1</th>
<th align="center">T1_M2</th>
<th align="center">T1_M3</th>
<th align="center">T2_M1</th>
<th align="center">T2_M2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">sp.1</td>
<td align="center">0.0</td>
<td align="center">1.0</td>
<td align="center">0.0</td>
<td align="center">0.0</td>
<td align="center">1.0</td>
</tr>
<tr class="even">
<td align="center">sp.2</td>
<td align="center">0.0</td>
<td align="center">0.0</td>
<td align="center">1.0</td>
<td align="center">0.0</td>
<td align="center">1.0</td>
</tr>
<tr class="odd">
<td align="center">sp.3</td>
<td align="center">0.0</td>
<td align="center">0.5</td>
<td align="center">0.5</td>
<td align="center">1.0</td>
<td align="center">0.0</td>
</tr>
<tr class="even">
<td align="center">sp.5</td>
<td align="center">0.2</td>
<td align="center">0.3</td>
<td align="center">0.5</td>
<td align="center">0.5</td>
<td align="center">0.5</td>
</tr>
<tr class="odd">
<td align="center">sp.6</td>
<td align="center">1.0</td>
<td align="center">0.0</td>
<td align="center">0.0</td>
<td align="center">1.0</td>
<td align="center">0.0</td>
</tr>
</tbody>
</table>
<p>As R has no knowledge on what these traits and modalities mean, a
<em>data.frame</em> called <em>S.traits.lab</em> describes the
modalities of each trait. Here also a numerical value (<em>score</em>)
is assigned to these modalities.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.traits.lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  colname  <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1_M1"</span>,<span class="st">"T1_M2"</span> ,<span class="st">"T1_M3"</span>,  <span class="st">"T2_M1"</span>,  <span class="st">"T2_M2"</span><span class="op">)</span>,</span>
<span>  trait    <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span>,<span class="st">"depth"</span> ,<span class="st">"depth"</span>,  <span class="st">"feeding"</span>,<span class="st">"feeding"</span><span class="op">)</span>,</span>
<span>  modality <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0-5cm"</span>,<span class="st">"5-10cm"</span>,<span class="st">"10-15cm"</span>,<span class="st">"filter"</span>, <span class="st">"deposit"</span><span class="op">)</span>, </span>
<span>  score    <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>    , <span class="fl">7.5</span>    , <span class="fl">12.5</span>    , <span class="fl">1</span>      , <span class="fl">2</span>     <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with trait descriptions</caption>
<thead><tr class="header">
<th align="center">colname</th>
<th align="center">trait</th>
<th align="center">modality</th>
<th align="center">score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">T1_M1</td>
<td align="center">depth</td>
<td align="center">0-5cm</td>
<td align="center">2.5</td>
</tr>
<tr class="even">
<td align="center">T1_M2</td>
<td align="center">depth</td>
<td align="center">5-10cm</td>
<td align="center">7.5</td>
</tr>
<tr class="odd">
<td align="center">T1_M3</td>
<td align="center">depth</td>
<td align="center">10-15cm</td>
<td align="center">12.5</td>
</tr>
<tr class="even">
<td align="center">T2_M1</td>
<td align="center">feeding</td>
<td align="center">filter</td>
<td align="center">1.0</td>
</tr>
<tr class="odd">
<td align="center">T2_M2</td>
<td align="center">feeding</td>
<td align="center">deposit</td>
<td align="center">2.0</td>
</tr>
</tbody>
</table>
<p>The trait <em>score</em> is required for recasting the fuzzy traits
into crisp format:.</p>
<table class="table">
<caption>Trait dataset in crisp format, based on the trait
score</caption>
<thead><tr class="header">
<th align="center">species</th>
<th align="center">depth</th>
<th align="center">feeding</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">sp.1</td>
<td align="center">7.5</td>
<td align="center">2.0</td>
</tr>
<tr class="even">
<td align="center">sp.2</td>
<td align="center">12.5</td>
<td align="center">2.0</td>
</tr>
<tr class="odd">
<td align="center">sp.3</td>
<td align="center">10.0</td>
<td align="center">1.0</td>
</tr>
<tr class="even">
<td align="center">sp.5</td>
<td align="center">9.0</td>
<td align="center">1.5</td>
</tr>
<tr class="odd">
<td align="center">sp.6</td>
<td align="center">2.5</td>
<td align="center">1.0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="a-crisp-trait-dataset">A crisp trait dataset<a class="anchor" aria-label="anchor" href="#a-crisp-trait-dataset"></a>
</h3>
<p>While for traits that are fuzzy coded, one species can belong to
different trait modalities, for traits in crisp (binary) format, a
species can belong only to ONE modality within one trait.</p>
<p>Thus, a crisp trait <em>data.frame</em> contains only <span class="math inline">\(0\)</span>s or <span class="math inline">\(1\)</span>s (or TRUE/FALSE) for ‘binary’ traits.
Traits can also have a value for ‘numerical’ traits, but they can also
be a factor or character string for ‘categorical’ traits.</p>
<p>Examples of ‘numerical’ traits for a taxon are, e.g. mean biomass,
mean longevity, respiration rate. The feeding type to which a taxon
belongs is a ‘categorical’ trait.</p>
<p>Here is an example of a crisp trait dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.traits2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  species   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp.1"</span>  ,<span class="st">"sp.2"</span>   ,<span class="st">"sp.3"</span>   ,<span class="st">"sp.5"</span>  ,<span class="st">"sp.6"</span><span class="op">)</span>,</span>
<span>  Feeding   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filter"</span>,<span class="st">"deposit"</span>,<span class="st">"deposit"</span>,<span class="st">"grazer"</span>,<span class="st">"filter"</span><span class="op">)</span>, <span class="co"># categorical</span></span>
<span>  Longlived <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>    ,<span class="cn">TRUE</span>     ,<span class="cn">FALSE</span>    ,<span class="cn">FALSE</span>   ,<span class="cn">TRUE</span><span class="op">)</span>,     <span class="co"># binary </span></span>
<span>  Weight    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>     ,<span class="fl">0.5</span>      ,<span class="fl">5</span>        ,<span class="fl">2</span>       ,<span class="fl">10</span>   <span class="op">)</span>     <span class="co"># numerical </span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with species trait information, crisp
coded</caption>
<thead><tr class="header">
<th align="center">species</th>
<th align="center">Feeding</th>
<th align="center">Longlived</th>
<th align="center">Weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">sp.1</td>
<td align="center">filter</td>
<td align="center">TRUE</td>
<td align="center">0.1</td>
</tr>
<tr class="even">
<td align="center">sp.2</td>
<td align="center">deposit</td>
<td align="center">TRUE</td>
<td align="center">0.5</td>
</tr>
<tr class="odd">
<td align="center">sp.3</td>
<td align="center">deposit</td>
<td align="center">FALSE</td>
<td align="center">5.0</td>
</tr>
<tr class="even">
<td align="center">sp.5</td>
<td align="center">grazer</td>
<td align="center">FALSE</td>
<td align="center">2.0</td>
</tr>
<tr class="odd">
<td align="center">sp.6</td>
<td align="center">filter</td>
<td align="center">TRUE</td>
<td align="center">10.0</td>
</tr>
</tbody>
</table>
<p>This data set in “fuzzy” format needs more columns:</p>
<table style="width:100%;" class="table">
<caption>Crisp trait dataset in fuzzy format</caption>
<colgroup>
<col width="9%">
<col width="17%">
<col width="16%">
<col width="16%">
<col width="17%">
<col width="16%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="center">species</th>
<th align="center">Feeding_deposit</th>
<th align="center">Feeding_filter</th>
<th align="center">Feeding_grazer</th>
<th align="center">Longlived_FALSE</th>
<th align="center">Longlived_TRUE</th>
<th align="center">Weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">sp.1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0.1</td>
</tr>
<tr class="even">
<td align="center">sp.2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0.5</td>
</tr>
<tr class="odd">
<td align="center">sp.3</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">5.0</td>
</tr>
<tr class="even">
<td align="center">sp.5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2.0</td>
</tr>
<tr class="odd">
<td align="center">sp.6</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">10.0</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-density-data-using-btrait-functions">Working with density data using Btrait functions<a class="anchor" aria-label="anchor" href="#working-with-density-data-using-btrait-functions"></a>
</h2>
<p>We now demonstrate how to use the functions from the R-package Btrait
to work with a combination of density, taxonomic and trait data</p>
<div class="section level3">
<h3 id="generating-density-summaries">Generating density summaries<a class="anchor" aria-label="anchor" href="#generating-density-summaries"></a>
</h3>
<p>We first make two tables, recasting the density data from
<em>long</em> into <em>wide</em> format, using function
<em>l2wDensity</em>, and where we either keep the years (first example),
or we average over the years (2nd example).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">S.density</span>,   <span class="co"># data in long format</span></span>
<span>     <span class="fu"><a href="../reference/long2wide.html">l2wDensity</a></span><span class="op">(</span>descriptor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">station</span>, <span class="va">year</span><span class="op">)</span>, </span>
<span>                taxon      <span class="op">=</span> <span class="va">species</span>, </span>
<span>                value      <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   station year sp.1 sp.2 sp.3 sp.4</span></span>
<span><span class="co">## 1    st.a 2000    1    2    0    0</span></span>
<span><span class="co">## 2    st.a 2001    4    0    0    2</span></span>
<span><span class="co">## 3    st.b 2002    0    5    3    1</span></span>
<span><span class="co">## 4    st.c 2003    0    0    0    3</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">S.density</span>, </span>
<span>     <span class="fu"><a href="../reference/long2wide.html">l2wDensity</a></span><span class="op">(</span>descriptor  <span class="op">=</span> <span class="va">station</span>, </span>
<span>                averageOver <span class="op">=</span> <span class="va">year</span>, </span>
<span>                taxon       <span class="op">=</span> <span class="va">species</span>, </span>
<span>                value       <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   descriptor sp.1 sp.2 sp.3 sp.4</span></span>
<span><span class="co">## 1       st.a  2.5    1    0    1</span></span>
<span><span class="co">## 2       st.b  0.0    5    3    1</span></span>
<span><span class="co">## 3       st.c  0.0    0    0    3</span></span></code></pre>
<p>The same can be done, but now returning the summaries in long format
using the function <em>getDensity</em>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">S.density</span>, </span>
<span>     <span class="fu"><a href="../reference/densityfun.html">getDensity</a></span><span class="op">(</span>descriptor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">station</span>, <span class="va">year</span><span class="op">)</span>, </span>
<span>                taxon      <span class="op">=</span> <span class="va">species</span>, </span>
<span>                value      <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   station year taxon value</span></span>
<span><span class="co">## 1    st.a 2000  sp.1     1</span></span>
<span><span class="co">## 2    st.a 2000  sp.2     2</span></span>
<span><span class="co">## 3    st.a 2001  sp.1     4</span></span>
<span><span class="co">## 4    st.a 2001  sp.4     2</span></span>
<span><span class="co">## 5    st.b 2002  sp.2     5</span></span>
<span><span class="co">## 6    st.b 2002  sp.3     3</span></span>
<span><span class="co">## 7    st.b 2002  sp.4     1</span></span>
<span><span class="co">## 8    st.c 2003  sp.4     3</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">S.density</span>, </span>
<span>     <span class="fu"><a href="../reference/densityfun.html">getDensity</a></span><span class="op">(</span>descriptor  <span class="op">=</span> <span class="va">station</span>, </span>
<span>                averageOver <span class="op">=</span> <span class="va">year</span>, </span>
<span>                taxon       <span class="op">=</span> <span class="va">species</span>, </span>
<span>                value       <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   descriptor taxon value</span></span>
<span><span class="co">## 1       st.a  sp.1   2.5</span></span>
<span><span class="co">## 2       st.a  sp.2   1.0</span></span>
<span><span class="co">## 3       st.a  sp.4   1.0</span></span>
<span><span class="co">## 4       st.b  sp.2   5.0</span></span>
<span><span class="co">## 5       st.b  sp.3   3.0</span></span>
<span><span class="co">## 6       st.b  sp.4   1.0</span></span>
<span><span class="co">## 7       st.c  sp.4   3.0</span></span></code></pre>
<p>The Btrait functions to extract densities work as follows:</p>
<ul>
<li>first the sum of the <em>value</em> is taken over
<em>descriptor</em> x <em>taxon</em> combinations,</li>
<li>then the average is taken over the vector passed by argument
<em>averageOver</em>, taking into account the hidden absences.</li>
</ul>
</div>
<div class="section level3">
<h3 id="merging-density-with-taxonomic-data">Merging density with taxonomic data<a class="anchor" aria-label="anchor" href="#merging-density-with-taxonomic-data"></a>
</h3>
<p>Base R has a convenient function to combine (merge) several datasets,
based on common information.</p>
<p>We use the <em>merge</em> function to add taxonomic information at a
higher taxonomic level to the density data.</p>
<p>In the code below, the density data, at species level is extended
with taxonomic information of each species.</p>
<p>When using this function, it is good practice to explicitly specify
the name of the column on which we need to merge the two datasets. In
our example, the column called “species” is the only column name that
both datasets (S.density and S.taxonomy) have in common, so in theory we
do not need to specify on which column the merger is done (argument
“by”), but here we do this for clarity.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.density.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">S.density</span>, </span>
<span>                       <span class="va">S.taxonomy</span>, </span>
<span>                       by<span class="op">=</span><span class="st">"species"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S.density.tax</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species station year density genus family order class</span></span>
<span><span class="co">## 1    sp.1    st.a 2000       1   g.1    f.1   o.1   c.1</span></span>
<span><span class="co">## 2    sp.1    st.a 2001       3   g.1    f.1   o.1   c.1</span></span>
<span><span class="co">## 3    sp.1    st.a 2001       1   g.1    f.1   o.1   c.1</span></span>
<span><span class="co">## 4    sp.2    st.a 2000       2   g.2    f.1   o.1   c.1</span></span>
<span><span class="co">## 5    sp.2    st.b 2002       5   g.2    f.1   o.1   c.1</span></span>
<span><span class="co">## 6    sp.3    st.b 2002       3   g.3    f.2   o.2   c.1</span></span></code></pre>
<p>Once the merge has been done, it is simple to generate tables with
densities calculated on higher taxonomic level.</p>
<p>As an example, we create density at family level, taking yearly
averages:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">S.density.tax</span>, </span>
<span>     <span class="fu"><a href="../reference/densityfun.html">getDensity</a></span><span class="op">(</span>descriptor  <span class="op">=</span> <span class="va">station</span>, </span>
<span>                averageOver <span class="op">=</span> <span class="va">year</span>, </span>
<span>                taxon       <span class="op">=</span> <span class="va">family</span>, </span>
<span>                value       <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   descriptor taxon value</span></span>
<span><span class="co">## 1       st.a   f.1   3.5</span></span>
<span><span class="co">## 2       st.a   f.2   1.0</span></span>
<span><span class="co">## 3       st.b   f.1   5.0</span></span>
<span><span class="co">## 4       st.b   f.2   4.0</span></span>
<span><span class="co">## 5       st.c   f.2   3.0</span></span></code></pre>
<p>The merged dataset can also be used to generate summaries based on
taxonomic identity. Below we request the summed densities, on family
level, for all taxa belonging to a particular order (<em>o.2</em>). We
use the argument <em>subset</em> to extract the data</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">S.density.tax</span>, </span>
<span>     <span class="fu"><a href="../reference/densityfun.html">getDensity</a></span><span class="op">(</span>descriptor  <span class="op">=</span> <span class="va">station</span>, </span>
<span>                averageOver <span class="op">=</span> <span class="va">year</span>, </span>
<span>                taxon       <span class="op">=</span> <span class="va">family</span>, </span>
<span>                subset      <span class="op">=</span> <span class="op">(</span><span class="va">order</span> <span class="op">==</span> <span class="st">"o.2"</span><span class="op">)</span>,</span>
<span>                value       <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   descriptor taxon value</span></span>
<span><span class="co">## 1       st.a   f.2     1</span></span>
<span><span class="co">## 2       st.b   f.2     4</span></span>
<span><span class="co">## 3       st.c   f.2     3</span></span></code></pre>
<p>Often we want to keep the names of the input data in the output,
which we can achieve by passing the arguments as <em>named
lists</em>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span> <span class="op">(</span><span class="va">S.density.tax</span>, </span>
<span>  <span class="fu"><a href="../reference/densityfun.html">getDensity</a></span><span class="op">(</span>descriptor  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>station<span class="op">=</span><span class="va">station</span><span class="op">)</span>, </span>
<span>             taxon       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span><span class="va">family</span><span class="op">)</span>, </span>
<span>             averageOver <span class="op">=</span> <span class="va">year</span>, </span>
<span>             value       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>density<span class="op">=</span><span class="va">density</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   station family density</span></span>
<span><span class="co">## 1    st.a    f.1     3.5</span></span>
<span><span class="co">## 2    st.a    f.2     1.0</span></span>
<span><span class="co">## 3    st.b    f.1     5.0</span></span>
<span><span class="co">## 4    st.b    f.2     4.0</span></span>
<span><span class="co">## 5    st.c    f.2     3.0</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="working-with-trait-data-">Working with trait data.<a class="anchor" aria-label="anchor" href="#working-with-trait-data-"></a>
</h2>
<div class="section level3">
<h3 id="from-wide-to-long-format">From wide to long format<a class="anchor" aria-label="anchor" href="#from-wide-to-long-format"></a>
</h3>
<p>While trait data are conveniently stored in wide format, sometimes it
may be easier to look at the trait data in long format. This format can
easily be generated from the wide format:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.traits.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/long2wide.html">w2lTrait</a></span><span class="op">(</span></span>
<span>            wide        <span class="op">=</span> <span class="va">S.traits</span>, </span>
<span>            trait.names <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trait"</span>, <span class="st">"modality"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">S.traits.long</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">S.traits.long</span><span class="op">$</span><span class="va">species</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    species   trait modality value</span></span>
<span><span class="co">## 3     sp.1   depth   5-10cm   1.0</span></span>
<span><span class="co">## 12    sp.1 feeding  deposit   1.0</span></span>
<span><span class="co">## 6     sp.2   depth  10-15cm   1.0</span></span>
<span><span class="co">## 13    sp.2 feeding  deposit   1.0</span></span>
<span><span class="co">## 4     sp.3   depth   5-10cm   0.5</span></span>
<span><span class="co">## 7     sp.3   depth  10-15cm   0.5</span></span>
<span><span class="co">## 9     sp.3 feeding   filter   1.0</span></span>
<span><span class="co">## 1     sp.5   depth    0-5cm   0.2</span></span>
<span><span class="co">## 5     sp.5   depth   5-10cm   0.3</span></span>
<span><span class="co">## 8     sp.5   depth  10-15cm   0.5</span></span>
<span><span class="co">## 10    sp.5 feeding   filter   0.5</span></span>
<span><span class="co">## 14    sp.5 feeding  deposit   0.5</span></span>
<span><span class="co">## 2     sp.6   depth    0-5cm   1.0</span></span>
<span><span class="co">## 11    sp.6 feeding   filter   1.0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="from-fuzzy-to-crisp-format">From fuzzy to crisp format<a class="anchor" aria-label="anchor" href="#from-fuzzy-to-crisp-format"></a>
</h3>
<p>The example trait database (S.traits) is fuzzy-coded, meaning that
one trait is represented by several modalities for which a taxon can
have partial membership. For instance, trait T1 (depth) for sp.2 can be
either expressed as modality M1 or M2, etc…</p>
<p>For summaries it may be more instructive to have one number for each
trait, i.e. to represent the trait data in crisp format. To do this, we
need to pass the trait.class that each column belongs to, and the score
that needs to be assigned to each modality.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.traits.crisp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traitfun.html">fuzzy2crisp</a></span><span class="op">(</span></span>
<span>            trait       <span class="op">=</span> <span class="va">S.traits</span>, </span>
<span>            trait.class <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">trait</span>, </span>
<span>            trait.score <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">score</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">S.traits.crisp</span>, </span>
<span>       caption<span class="op">=</span><span class="st">"Data.frame with species traits in crisp format"</span>, </span>
<span>       align<span class="op">=</span><span class="st">"c"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with species traits in crisp format</caption>
<thead><tr class="header">
<th align="center">species</th>
<th align="center">depth</th>
<th align="center">feeding</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">sp.1</td>
<td align="center">7.5</td>
<td align="center">2.0</td>
</tr>
<tr class="even">
<td align="center">sp.2</td>
<td align="center">12.5</td>
<td align="center">2.0</td>
</tr>
<tr class="odd">
<td align="center">sp.3</td>
<td align="center">10.0</td>
<td align="center">1.0</td>
</tr>
<tr class="even">
<td align="center">sp.5</td>
<td align="center">9.0</td>
<td align="center">1.5</td>
</tr>
<tr class="odd">
<td align="center">sp.6</td>
<td align="center">2.5</td>
<td align="center">1.0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="from-crisp-to-fuzzy-format">From crisp to fuzzy format<a class="anchor" aria-label="anchor" href="#from-crisp-to-fuzzy-format"></a>
</h3>
<p>It is also possible to cast traits from fuzzy to crisp format:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traitfun.html">crisp2fuzzy</a></span><span class="op">(</span><span class="va">S.traits.crisp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species depth feeding</span></span>
<span><span class="co">## 1    sp.1   7.5     2.0</span></span>
<span><span class="co">## 2    sp.2  12.5     2.0</span></span>
<span><span class="co">## 3    sp.3  10.0     1.0</span></span>
<span><span class="co">## 4    sp.5   9.0     1.5</span></span>
<span><span class="co">## 5    sp.6   2.5     1.0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="extending-traits-based-on-taxonomic-information">Extending traits based on taxonomic information<a class="anchor" aria-label="anchor" href="#extending-traits-based-on-taxonomic-information"></a>
</h3>
<p>The trait database has information for species “sp.1”, “sp.2”, “sp.3”
that are present in our density data, but it lacks data for species
“sp.4”.</p>
<p>If we need traits for each species, we can use the taxonomic
relationships of the species. For instance “sp.4” belongs to the same
genus as “sp.3” and “sp.5”, so “plausible” values for the traits of
species “sp.4” can be calculated as the mean of the two other members of
the genus.</p>
<p>Using function <em>getTrait</em>, it suffices to pass the taxonomy to
do this.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taxaList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">S.density</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/traitfun.html">getTrait</a></span><span class="op">(</span>   taxon    <span class="op">=</span> <span class="va">taxaList</span>,</span>
<span>            trait    <span class="op">=</span> <span class="va">S.traits</span>,  </span>
<span>            taxonomy <span class="op">=</span> <span class="va">S.taxonomy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species T1_M1 T1_M2 T1_M3 T2_M1 T2_M2</span></span>
<span><span class="co">## 1    sp.1   0.0   1.0   0.0  0.00  1.00</span></span>
<span><span class="co">## 2    sp.2   0.0   0.0   1.0  0.00  1.00</span></span>
<span><span class="co">## 3    sp.4   0.1   0.4   0.5  0.75  0.25</span></span>
<span><span class="co">## 4    sp.3   0.0   0.5   0.5  1.00  0.00</span></span></code></pre>
<p>This function proceeds in two steps:</p>
<ul>
<li>first the traits are extended with information on higher taxonomic
levels (using function <em>extendTrait</em>), provided that information
is not yet in the trait database,</li>
<li>then, for each taxon that is not present in the trait database, the
traits on the closest taxonomic level are used. For instance, for an
unrecorded species, it is first checked if the trait is known on genus
level, if not, family level and so on.</li>
</ul>
<p>In our case, species “sp.4” belongs to genus “g.3”, so in lack of
trait information for “sp.4”, the traits from “g.3” will be used; the
latter estimated as the average of traits for species “sp.3” and “sp.5”,
for which trait information is known.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.traits.extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traitfun.html">extendTrait</a></span><span class="op">(</span></span>
<span>            trait    <span class="op">=</span> <span class="va">S.traits</span>, </span>
<span>            taxonomy <span class="op">=</span> <span class="va">S.taxonomy</span><span class="op">)</span></span>
<span><span class="va">S.traits.extended</span></span></code></pre></div>
<pre><code><span><span class="co">##    species T1_M1     T1_M2     T1_M3     T2_M1     T2_M2</span></span>
<span><span class="co">## 1      g.1  0.00 1.0000000 0.0000000 0.0000000 1.0000000</span></span>
<span><span class="co">## 2      g.2  0.00 0.0000000 1.0000000 0.0000000 1.0000000</span></span>
<span><span class="co">## 3      g.3  0.10 0.4000000 0.5000000 0.7500000 0.2500000</span></span>
<span><span class="co">## 4      g.4  1.00 0.0000000 0.0000000 1.0000000 0.0000000</span></span>
<span><span class="co">## 5      f.1  0.00 0.5000000 0.5000000 0.0000000 1.0000000</span></span>
<span><span class="co">## 6      f.2  0.10 0.4000000 0.5000000 0.7500000 0.2500000</span></span>
<span><span class="co">## 7      f.3  1.00 0.0000000 0.0000000 1.0000000 0.0000000</span></span>
<span><span class="co">## 8      o.1  0.00 0.5000000 0.5000000 0.0000000 1.0000000</span></span>
<span><span class="co">## 9      o.2  0.40 0.2666667 0.3333333 0.8333333 0.1666667</span></span>
<span><span class="co">## 10     c.1  0.24 0.3600000 0.4000000 0.5000000 0.5000000</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traitfun.html">getTrait</a></span><span class="op">(</span>   taxon    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">S.density</span><span class="op">$</span><span class="va">species</span><span class="op">)</span>,</span>
<span>            trait    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">S.traits</span>, <span class="va">S.traits.extended</span><span class="op">)</span>, </span>
<span>            taxonomy <span class="op">=</span> <span class="va">S.taxonomy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species T1_M1 T1_M2 T1_M3 T2_M1 T2_M2</span></span>
<span><span class="co">## 1    sp.1   0.0   1.0   0.0  0.00  1.00</span></span>
<span><span class="co">## 2    sp.2   0.0   0.0   1.0  0.00  1.00</span></span>
<span><span class="co">## 3    sp.4   0.1   0.4   0.5  0.75  0.25</span></span>
<span><span class="co">## 4    sp.3   0.0   0.5   0.5  1.00  0.00</span></span></code></pre>
<p>We can also use the taxonomy to generate mean trait modalities on
higher taxonomic levels:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This does not work, as these genera are not in the traits database</span></span>
<span><span class="fu"><a href="../reference/traitfun.html">getTrait</a></span><span class="op">(</span> taxon    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g.1"</span>, <span class="st">"g.2"</span>, <span class="st">"g.3"</span><span class="op">)</span>,</span>
<span>          trait    <span class="op">=</span> <span class="va">S.traits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   taxon T1_M1 T1_M2 T1_M3 T2_M1 T2_M2</span></span>
<span><span class="co">## 1   g.1    NA    NA    NA    NA    NA</span></span>
<span><span class="co">## 2   g.2    NA    NA    NA    NA    NA</span></span>
<span><span class="co">## 3   g.3    NA    NA    NA    NA    NA</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traitfun.html">getTrait</a></span><span class="op">(</span> taxon    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"g.1"</span>, <span class="st">"g.2"</span>, <span class="st">"g.3"</span><span class="op">)</span>,</span>
<span>          trait    <span class="op">=</span> <span class="va">S.traits</span>,</span>
<span>          taxonomy <span class="op">=</span> <span class="va">S.taxonomy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   species T1_M1 T1_M2 T1_M3 T2_M1 T2_M2</span></span>
<span><span class="co">## 1     g.1   0.0   1.0   0.0  0.00  1.00</span></span>
<span><span class="co">## 2     g.2   0.0   0.0   1.0  0.00  1.00</span></span>
<span><span class="co">## 3     g.3   0.1   0.4   0.5  0.75  0.25</span></span></code></pre>
<p>In the first statement, we deliberately forgot to add the taxonomic
relationships; as none of the genera are explicitly included in the
trait database S.traits, this returns a table with NAs.</p>
<p>In the second statement, the traits on genus level are estimated as
averages of species traits.</p>
</div>
</div>
<div class="section level2">
<h2 id="from-taxon-density-to-trait-density">From taxon density to trait density<a class="anchor" aria-label="anchor" href="#from-taxon-density-to-trait-density"></a>
</h2>
<p>Often we want to combine the density with the trait information, to
find the mean values of traits at certain locations.</p>
<p>These <em>community weighted mean</em> trait scores for each station
are estimated by combining the density, taxonomy, and trait data.</p>
<p>This can be done in one step, using function
<em>getTraitDensity</em>.</p>
<ul>
<li>When, for fuzzy-coded traits, we also pass the trait
<em>classes</em> and trait <em>scores</em>, then the fuzzy traits will
be cast in crisp format; when we do NOT pass this information, then the
result will remain in fuzzy format.</li>
<li>If we pass taxonomical information of the taxa, then the trait
scores for unknown species are estimated based on taxonomic
closeness.</li>
</ul>
<p>In the next example, we combine the yearly-averaged density data in
<em>S.density</em>, with the fuzzy-coded trait database
<em>S.traits</em>. This trait database records 5 modalities of 2 traits
(as columns). The data.frame <em>S.traits.lab</em> describes to which
trait these modalities belong. By passing this information, the result
will be in crisp format.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTraitDensity.html">getTraitDensity</a></span><span class="op">(</span></span>
<span>        descriptor  <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">station</span>, </span>
<span>        taxon       <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">species</span>,</span>
<span>        averageOver <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">year</span>,</span>
<span>        value       <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">density</span>, </span>
<span>        trait       <span class="op">=</span> <span class="va">S.traits</span>,             <span class="co"># fuzzy coded traits per station</span></span>
<span>        trait.class <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">trait</span>,   <span class="co"># fuzzy trait class for S.trait columns</span></span>
<span>        trait.score <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">score</span>,   <span class="co"># modality value </span></span>
<span>        taxonomy    <span class="op">=</span> <span class="va">S.taxonomy</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cwm</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">descriptor</th>
<th align="right">depth</th>
<th align="right">feeding</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">st.a</td>
<td align="right">9.166667</td>
<td align="right">1.777778</td>
</tr>
<tr class="even">
<td align="left">st.b</td>
<td align="right">11.388889</td>
<td align="right">1.555556</td>
</tr>
<tr class="odd">
<td align="left">st.c</td>
<td align="right">10.000000</td>
<td align="right">1.000000</td>
</tr>
</tbody>
</table>
<p>Without the taxonomy, the trait scores for station “st.c” cannot be
calculated, as trait information is lacking for “sp.4”, the only taxon
present in this station. Also the scores for the other stations will
differ, as they are estimated without “sp.4”.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTraitDensity.html">getTraitDensity</a></span><span class="op">(</span></span>
<span>         descriptor  <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">station</span>, </span>
<span>         averageOver <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">year</span>,</span>
<span>         taxon       <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">species</span>, </span>
<span>         value       <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">density</span>, </span>
<span>         trait       <span class="op">=</span> <span class="va">S.traits</span>,             </span>
<span>         trait.class <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">trait</span>,    </span>
<span>         trait.score <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">score</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cwm2</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">descriptor</th>
<th align="right">depth</th>
<th align="right">feeding</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">st.a</td>
<td align="right">8.928571</td>
<td align="right">2.000</td>
</tr>
<tr class="even">
<td align="left">st.b</td>
<td align="right">11.562500</td>
<td align="right">1.625</td>
</tr>
<tr class="odd">
<td align="left">st.c</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<p>If we do not pass the trait classes and scores, then the function
<em>getTraitDensity</em> will return the trait scores in fuzzy format.
These fuzzy traits can then later be recast in crisp format, which gives
the stations trait scores as before.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwm.fuz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTraitDensity.html">getTraitDensity</a></span><span class="op">(</span></span>
<span>            descriptor  <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">station</span>, </span>
<span>            averageOver <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">year</span>,</span>
<span>            taxon       <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">species</span>, </span>
<span>            value       <span class="op">=</span> <span class="va">S.density</span><span class="op">$</span><span class="va">density</span>, </span>
<span>            trait       <span class="op">=</span> <span class="va">S.traits</span>,           <span class="co"># fuzzy coded traits per station</span></span>
<span>            taxonomy    <span class="op">=</span> <span class="va">S.taxonomy</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cwm.fuz</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">descriptor</th>
<th align="right">T1_M1</th>
<th align="right">T1_M2</th>
<th align="right">T1_M3</th>
<th align="right">T2_M1</th>
<th align="right">T2_M2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">st.a</td>
<td align="right">0</td>
<td align="right">0.6666667</td>
<td align="right">0.3333333</td>
<td align="right">0.2222222</td>
<td align="right">0.7777778</td>
</tr>
<tr class="even">
<td align="left">st.b</td>
<td align="right">0</td>
<td align="right">0.2222222</td>
<td align="right">0.7777778</td>
<td align="right">0.4444444</td>
<td align="right">0.5555556</td>
</tr>
<tr class="odd">
<td align="left">st.c</td>
<td align="right">0</td>
<td align="right">0.5000000</td>
<td align="right">0.5000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traitfun.html">fuzzy2crisp</a></span><span class="op">(</span>trait      <span class="op">=</span> <span class="va">cwm.fuz</span>, </span>
<span>           trait.class <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">trait</span>,   </span>
<span>           trait.score <span class="op">=</span> <span class="va">S.traits.lab</span><span class="op">$</span><span class="va">score</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   descriptor     depth  feeding</span></span>
<span><span class="co">## 1       st.a  9.166667 1.777778</span></span>
<span><span class="co">## 2       st.b 11.388889 1.555556</span></span>
<span><span class="co">## 3       st.c 10.000000 1.000000</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="show-results">Show results<a class="anchor" aria-label="anchor" href="#show-results"></a>
</h2>
<p>For plotting, we need the coordinates of the stations (longitude
<em>x</em>, latitude <em>y</em>):</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S.stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  station <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"st.a"</span>,<span class="st">"st.b"</span>,<span class="st">"st.c"</span><span class="op">)</span>,</span>
<span>  x       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>   <span class="fl">3.1</span>,   <span class="fl">3.2</span>,   <span class="fl">3.5</span><span class="op">)</span>,</span>
<span>  y       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>  <span class="fl">52.2</span>,  <span class="fl">53.7</span>,  <span class="fl">53.4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data.frame with station positions</caption>
<thead><tr class="header">
<th align="center">station</th>
<th align="center">x</th>
<th align="center">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">st.a</td>
<td align="center">3.1</td>
<td align="center">52.2</td>
</tr>
<tr class="even">
<td align="center">st.b</td>
<td align="center">3.2</td>
<td align="center">53.7</td>
</tr>
<tr class="odd">
<td align="center">st.c</td>
<td align="center">3.5</td>
<td align="center">53.4</td>
</tr>
</tbody>
</table>
<p>The mean trait values per station can be plotted using function
<em>mapBtrait</em>.</p>
<p>For this function to work, we need to add the stations coordinates to
the community weighted mean data. We use R-function <em>merge</em> for
this; the column on which to merge the station and cwm data is the first
one for both datasets (here we do not specify the name of the common
column but rather its position).</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Stations.traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">S.stations</span>, <span class="va">cwm</span>, by<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cwm</span><span class="op">)</span></span>
<span><span class="va">nunits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cm"</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nscore</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/BtraitMap.html">mapBtrait</a></span><span class="op">(</span>x      <span class="op">=</span> <span class="va">S.stations</span><span class="op">$</span><span class="va">x</span>,    <span class="co">#x-positions</span></span>
<span>           y      <span class="op">=</span> <span class="va">S.stations</span><span class="op">$</span><span class="va">y</span>,    <span class="co">#y-positions</span></span>
<span>           colvar <span class="op">=</span> <span class="va">cwm</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,         <span class="co">#color-variable</span></span>
<span>           </span>
<span>           contours<span class="op">=</span><span class="va">MWTL</span><span class="op">$</span><span class="va">contours</span>,   <span class="co">#contourlines</span></span>
<span>           draw.levels<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>           </span>
<span>           main    <span class="op">=</span><span class="va">nscore</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,       <span class="co">#main title</span></span>
<span>           clab    <span class="op">=</span><span class="va">nunits</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,       <span class="co">#title above color bar</span></span>
<span>           pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Btrait_files/figure-html/unnamed-chunk-38-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Beauchard O, Brind’Amour A, Schratzberger M, Laffargue P, Hintzen NT,
Somerfield PJ, Piet G (2021) A generic approach to develop a trait-based
indicator of trawling-induced disturbance. Mar Ecol Prog Ser 675:35-52.
<a href="https://doi.org/10.3354/meps13840" class="external-link uri">https://doi.org/10.3354/meps13840</a></p>
<p>Wilson, R. J., Speirs, D. C., Sabatino, A., and Heath, M. R. (2018).
A synthetic map of the north-west European Shelf sedimentary environment
for applications in marine science. Earth Sys. Sci. Data 10, 109–130.
doi: 10.5194/essd-10-109-2018</p>
<p>R Core Team (2022). <em>R: A Language and Environment for Statistical
Computing</em>. R Foundation for Statistical Computing, Vienna, Austria.
<a href="https://www.R-project.org/" class="external-link uri">https://www.R-project.org/</a>.</p>
<p>Soetaert K (2021). <em>plot3D: Plotting Multi-Dimensional Data</em>.
R package version 1.4, <a href="https://CRAN.R-project.org/package=plot3D" class="external-link uri">https://CRAN.R-project.org/package=plot3D</a>.</p>
<p>Soetaert K, Beauchard O (2023). <em>Btrait: Working with Biological
density, taxonomy, and trait composition data</em>. R package version
0.0.0.</p>
<p>Holstein J (2018). <em>worms: Retriving Aphia Information from World
Register of Marine Species</em>. R package version 0.2.2, <a href="https://CRAN.R-project.org/package=worms" class="external-link uri">https://CRAN.R-project.org/package=worms</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Karline Soetaert.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
